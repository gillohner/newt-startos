# Instructions for Newt

## Prerequisites

Before installing Newt on StartOS, you must have a **Pangolin** instance set up.
Pangolin is the control plane that manages Newt clients.

- Visit [Pangolin.net](https://pangolin.net/) to set up your Pangolin instance
- Full documentation: [docs.pangolin.net](https://docs.pangolin.net/)

## Configuration

### Step 1: Create a Resource in Pangolin

1. Log into your Pangolin dashboard
2. Create a new resource for this Newt client
3. Pangolin will generate three credentials for you:
   - **Client ID** - A unique identifier for this client
   - **Client Secret** - Authentication secret (keep this private!)
   - **Pangolin Endpoint** - The URL where your Pangolin server is hosted

### Step 2: Configure Newt on StartOS

Newt can be configured in two ways:

#### Option A: Edit Configuration File (Recommended)

1. After installing Newt, access the service volume (via SSH or file manager)
2. Navigate to the Newt data directory
3. Edit the `config.json` file:

```json
{
  "clientId": "your-client-id-from-pangolin",
  "secret": "your-secret-from-pangolin",
  "endpoint": "https://your-pangolin-server.com",
  "acceptClients": false,
  "native": false,
  "logLevel": "info"
}
```

4. Restart the Newt service for changes to take effect

#### Option B: SSH Configuration

You can also configure via SSH by accessing the StartOS server and editing the
config file directly:

```bash
# SSH into your StartOS server
ssh start9@your-startos-server.local

# Access the Newt container
sudo docker exec -it newt.embassy sh

# Edit the configuration file
vi /home/newt/config.json

# Restart the service from StartOS web interface
```

### Configuration Options

- **clientId**: The unique client ID generated by Pangolin
- **secret**: The authentication secret from Pangolin
- **endpoint**: Your Pangolin server endpoint (e.g.,
  `https://pangolin.riginode.xyz`)
- **acceptClients**: Set to `true` to allow other clients to connect through
  this Newt instance
- **native**: Set to `true` for native mode (requires `acceptClients: true`)
- **logLevel**: Set logging level (`error`, `warn`, `info`, `debug`)

### Step 3: Start the Service

1. Start the Newt service from the StartOS web interface
2. Check the logs to ensure successful connection to Pangolin
3. Configure routing in your Pangolin dashboard

## Monitoring

The Newt service exposes Prometheus metrics on port 2112 for automated
monitoring systems. These metrics are not intended for direct user access but
can be scraped by Prometheus or other monitoring tools to track:

- Connection status
- Data transfer statistics
- Active tunnels
- Performance metrics

To access metrics programmatically: `http://your-startos-ip:2112/metrics`

## Troubleshooting

### Connection Issues

If you're getting SSL/connection errors like `PR_END_OF_FILE_ERROR`:

1. **Check Configuration**: Ensure your `clientId`, `secret`, and `endpoint` are
   correctly set in `config.json`
2. **Verify Pangolin Server**: Make sure your Pangolin server is running and
   accessible
3. **Check Logs**: View Newt service logs in StartOS for detailed error messages
4. **Network**: Ensure StartOS can reach your Pangolin endpoint (check
   firewall/network settings)

### Service Won't Start

1. Check the service logs in StartOS interface
2. Verify configuration file format is valid JSON
3. Ensure all required fields are populated
4. Try restarting the service

### No Metrics Available

1. Verify port 2112 is accessible
2. Check if the service is running
3. Look for firewall blocking the metrics port

## Support

- **Newt Documentation**: [docs.pangolin.net](https://docs.pangolin.net/)
- **Pangolin Support**: [pangolin.net](https://pangolin.net/)
- **Newt GitHub**: [github.com/fosrl/newt](https://github.com/fosrl/newt)
- **StartOS Community**: [start9.com/support](https://start9.com/support)
